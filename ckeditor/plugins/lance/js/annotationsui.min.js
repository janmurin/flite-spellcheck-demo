/*!
 * Source version: 1.1.08 
 * Copyright (C) 2018 LoopIndex - All Rights Reserved
 * You may use, distribute and modify this code under the
 * terms of the LoopIndex Comments CKEditor plugin license.
 *
 * Open source libraries
 * jQuery scrollintoview plugin Copyright (c) 2011 Robert Koritnik https://github.com/litera/jquery-scrollintoview
 * MutationSummary copyright (C) Rafael Weinstein https://github.com/rafaelw/mutation-summary/
 * jQuery autogrow based on code by Jevin O. Sewaruth (https://github.com/jevin/Autogrow-Textarea)
 
 * You should have received a copy of the LoopIndex Comments CKEditor plugin license with
 * this file. If not, please write to: loopindex@gmail.com, or visit http://www.loopindex.com
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 */!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){!function(){"use strict";
/*! 
 * @license 
 * ----------------------------------------------------------------------------
 * "THE BEER-WARE LICENSE" (Revision 42):
 * <jevin9@gmail.com> wrote this file. As long as you retain this notice you
 * can do whatever you want with this stuff. If we meet some day, and you think
 * this stuff is worth it, you can buy me a beer in return. Jevin O. Sewaruth
 * ----------------------------------------------------------------------------
 *
 * Autogrow Textarea Plugin Version v3.0
 * http://www.technoreply.com/autogrow-textarea-plugin-3-0
 * (Modified by David Frenkiel)
 * THIS PLUGIN IS DELIVERD ON A PAY WHAT YOU WHANT BASIS. IF THE PLUGIN WAS USEFUL TO YOU, PLEASE CONSIDER BUYING THE PLUGIN HERE :
 * https://sites.fastspring.com/technoreply/instant/autogrowtextareaplugin
 *
 * Date: October 15, 2012
 */
/*! 
 * @license 
 * ----------------------------------------------------------------------------
 * "THE BEER-WARE LICENSE" (Revision 42):
 * <jevin9@gmail.com> wrote this file. As long as you retain this notice you
 * can do whatever you want with this stuff. If we meet some day, and you think
 * this stuff is worth it, you can buy me a beer in return. Jevin O. Sewaruth
 * ----------------------------------------------------------------------------
 *
 * Autogrow Textarea Plugin Version v3.0
 * http://www.technoreply.com/autogrow-textarea-plugin-3-0
 * (Modified by David Frenkiel)
 * THIS PLUGIN IS DELIVERD ON A PAY WHAT YOU WHANT BASIS. IF THE PLUGIN WAS USEFUL TO YOU, PLEASE CONSIDER BUYING THE PLUGIN HERE :
 * https://sites.fastspring.com/technoreply/instant/autogrowtextareaplugin
 *
 * Date: October 15, 2012
 */
!function(t){jQuery.fn.autoGrow=function(e){var n=e||{},i=n.css||{},o={"overflow-x":"hidden"};return t.extend(o,i),this.each(function(){var t,e=function(t){return t.next(".autogrow-textarea-mirror")[0]},i=function(t){var e=String(t.value),n=e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />")||"M";e.length&&10===e.charCodeAt(e.length-1)&&(n+="."),a.innerHTML=n;var i=jQuery(t),o=jQuery(a),r=Math.ceil(i.height()),s=Math.floor(.96*i.width());s!=Math.floor(o.width())&&o.width(s);var l=Math.ceil(o.height());i.attr("data-full-height",l),r!=l&&i.height(l)};t=function(t){i(this)};var r=jQuery(this),a=e(r)||function(t){return t.after('<div class="autogrow-textarea-mirror"></div>'),e(t)}(r);if(r.off("input propertychange",t),"destroy"in n)a.remove();else{var s=a.style;s.visibility="hidden",s.position="absolute",s.opacity="0",s.wordWrap="break-word",s.whiteSpace="normal",s.padding=r.css("padding"),s.fontFamily=r.css("font-family"),s.fontSize=r.css("font-size"),s.lineHeight=r.css("line-height"),r.css(o),this.style.minHeight=this.rows+"em",r.on("input propertychange",t),!1!==n.fitOnInit&&i(this)}})}}(window.jQuery),function(){var t=window.$LOOPINDEX$;if(!t||"object"!=typeof t){t=window.$LOOPINDEX$={};var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];!function(){var e=[],n=null;if("object"==typeof CKEDITOR&&CKEDITOR.document){var i=CKEDITOR.document.getWindow;CKEDITOR.document.getWindow=function(){var o=Array.prototype.slice.call(arguments),r=i.apply(CKEDITOR.document,o);return e.push(r),n&&t.overrideViewPaneSize(n),r}}t.overrideViewPaneSize=function(t){n=t,e.forEach(function(e){if(!e.__OVERRIDE_GVPS__){var n=e.getViewPaneSize;e.__OVERRIDE_GVPS__=!0,e.getViewPaneSize=function(){var i=Array.prototype.slice.call(arguments),o=n.apply(e,i);return t(o)}}})}}();var n=function(){var t=navigator.userAgent.toLowerCase(),e=function(t){t=t.toLowerCase();var e=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return{browser:e[1]||"",version:e[2]||"0"}}(t),n={type:"unknown",version:0,msie:!1};return e.browser&&(n[e.browser]=!0,n.version=e.version||0,n.type=e.browser),n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0),n.webkit&&(n.type="webkit"),n.firefox=!0===/firefox/.test(t),n.msie||(n.msie=Boolean(/trident/.test(t))),n}();t.EventsMixin={_listeners:function(t){this._listeners_=this._listeners_||{};var e=this._listeners_;return e[t=t||""]||(e[t]=[]),e[t]},_cleanup:function(){var t=this._listeners_;t&&Object.keys(t).forEach(function(e){var n=t[e];n&&n.length||delete t[e]})},addListener:function(e,n,i,o){if(!e)return t.Logger.warn("cannot register to empty event"),this;if(e instanceof Array){var r=this;e.forEach(function(t){r.addListener(t,n,i)})}else if("function"==typeof n){this._listeners(e).push({scope:i,callback:n,options:o})}else t.Logger.error("events mixin addListener: bad callback",n);return this},removeListener:function(t,e){if(!t&&!e)return this;if(e||"object"!=typeof t||(e=t,t=null),t instanceof Array){var n=this;return t.forEach(function(t){n.removeListener(t,e)}),this}function i(t,n){return t&&(!e||t.scope===e||t.callback===e)}var o=this._listeners_||{};return Object.keys(o).forEach(function(e){t&&t!==e||o[e].removeAll_li(i)}),this._cleanup(),this},removeAllListeners:function(){this._listeners_={}},_notifyListeners:function(e){if(void 0===e||null===e||""===e)return t.Logger.warn("cannot trigger empty event");var n=this._listeners(e),i=n.slice(),o=[],r=Array.prototype.slice.call(arguments,1);i.forEach(function(t){t.callback.apply(t.scope,r),t.options&&t.options.count&&(--t.options.count,t.options.count<=0&&o.push(t))}),o.length&&(o.forEach(function(t){n.remove_li(t)}),this._cleanup())},once:function(t,e,n,i){return(i=i||{}).count=1,this.on(t,e,n,i)}},t.EventsMixin.trigger=t.EventsMixin.fire=t.EventsMixin._notifyListeners,t.EventsMixin.on=t.EventsMixin.bind=t.EventsMixin.addListener,t.EventsMixin.off=t.EventsMixin.removeListener,t.Utils=t.Utils||t.utils||{},t.utils=t.Utils,t.utils.padString=function(t,e,n,i){t=null===t||void 0===t?"":String(t);for(var o=(n=String(n)).length,r=t.length;r<e;r+=o)i?t+=padWidth:t=n+t;return t},t.utils.padNumber=function(e,n){return n=n||2,t.utils.padString(e,n,"0")},t.utils.compareNodePosition=function(t,e){if(t==e)return 0;var n=(t.$||t).compareDocumentPosition(e.$||e);return 4&n?-1:8&n?-1:1},t.utils.relativeDateFormat=function(n,i){if(!n)return"";var r,a,s,l,c=new Date,u=c.getDate(),m=c.getMonth(),d=c.getFullYear(),h=i||function(t){return t};"string"!=(r=typeof n)&&"number"!=r||(n=new Date(1e3*Number(n)));var f=h("months")||e,_={dateString:n.toLocaleDateString()};return"string"==typeof f&&(f=f.split(",").map(function(t){return t.trim()})),_.months=f,u==n.getDate()&&m==n.getMonth()&&d==n.getFullYear()?(s=Math.floor((c.getTime()-n.getTime())/6e4),_.minutesAgo=s,s<1?h("now"):s<2?h("1 minute ago"):s<60?(a=h("minutes ago"))?o(a,n,h,_):s+"minutes ago":(a=h("on time"))?o(a,n,h,_):(l=n.getHours(),s=n.getMinutes(),"on "+t.utils.padNumber(l,2)+":"+t.utils.padNumber(s,2,"0"))):d==n.getFullYear()?(a=h("on date"))?o(a,n,h,_):"on "+f[n.getMonth()]+" "+n.getDate():(a=h("on full date"))?o(a,n,h,_):n.toLocaleDateString()},t.utils.getElementClampInWindowValues=function(t,e){var n=t.offset(),i={x:0,y:0},o=t.width(),r=t.height(),a=t[0].ownerDocument,s=a&&(a.defaultView||a.parentWindow);return s?(e=e||0,n.top-e<=s.pageYOffset?i.y=s.pageYOffset-n.top+e:n.top+r+e>s.pageYOffset+s.innerHeight&&(i.y=s.pageYOffset+s.innerHeight-n.top-r-e),n.left-e<s.pageXOffset?i.x=s.pageXOffset-n.left+e:n.left+o+e>s.pageXOffset+s.innerWidth&&(i.x=s.pageXOffset+s.innerWidth-n.left-o-e),i):i},t.utils.isElementOnScreen=function(e){var n=t.utils.getElementClampInWindowValues(e);return 0===n.x&&0===n.y},t.utils.scrollToElement=function(e,n){if(e)return t.utils.initJquery(),e.scrollintoview()},t.utils.randomString=function(t){t=t||6;var e=(new Date).getTime().toString(),n=btoa(e).replace(/[^a-z]/gi,"");return n.length>t&&(n=n.substring(n.length-t)),n},t.utils.timeOfTimestamp=function(e){if(!e)return"";var n=typeof e;"string"!=n&&"number"!=n||(e=new Date(1e3*e));var i=e.getHours(),o=e.getMinutes();return t.utils.padString(i,2,"0")+":"+t.utils.padString(o,2,"0")},t.utils.datetimeOfTimestamp=function(e){if(!e)return"";var n=typeof date;return"string"!=n&&"number"!=n||(date=new Date(1e3*date)),t.utils.dateOfTimestamp(e)+", "+t.utils.timeOfTimestamp(e)},t.utils.minuteAgoOfTimestamp=function(t){if(!t)return"";var e=new Date;t instanceof Date&&(t=t.getTime());var n=Math.round(e.getTime()/1e3)-t;return parseInt(n/60)},t.utils.secondAgoOfTimestamp=function(t){if(!t)return"";var e=new Date;t instanceof Date&&(t=t.getTime());var n=Math.round(e.getTime()/1e3)-t;return n<0&&(n=0),n},t.utils.fullDateFormat=function(t){if(!t)return"";var e=typeof t;"string"!=e&&"number"!=e||(t=new Date(1e3*t));return t.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]+" "+t.getFullYear()},t.utils.fullDateTimeFormat=function(e){return t.utils.fullDateFormat(e)+" "+t.utils.timeOfTimestamp(e)},t.utils.fullLocalDateFormat=function(t){return t?(date="string"==typeof t||"number"==typeof t?new Date(1e3*t):t,date.toLocaleDateString()):""},t.utils.fullLocalDateTimeFormat=function(t){if(!t)return"";var e=typeof t;return"string"!=e&&"number"!=e||(t=new Date(1e3*t)),t.toLocaleString()},t.utils.shorthandDateTime=function(e){if(!e)return"";var n=new Date,i=n.getDate(),o=n.getMonth(),r=n.getFullYear(),a=typeof e;"string"!=a&&"number"!=a||(e=new Date(1e3*e));var s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return i==e.getDate()&&o==e.getMonth()&&r==e.getFullYear()?t.utils.timeOfTimestamp(e):r==e.getFullYear()?s[e.getMonth()]+" "+e.getDate():s[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()},t.utils.URLArguments={getArgument:function(t,e){return this._parseLocation(),this._args.hasOwnProperty(t)?decodeURIComponent(this._args[t]):e},getNumericArgument:function(t,e){var n=this.getArgument(t,""),i=parseInt(n,10);return isNaN(i)&&(i=e),i},getAllArguments:function(){this._parseLocation();var t,e={};for(t in this._args)this._args.hasOwnProperty(t)&&(e[t]=this._args[t]);return e},createSearchString:function(t){if(!t)return"";var e,n,i="";for(e in t)t.hasOwnProperty(e)&&"function"!=typeof(n=t[e])&&(i.length&&(i+="&"),i+=e+"="+decodeURIComponent(n));return i},parse:function(t,e){if(e=e||{},"string"!=typeof t||t.length<1)return{};var n=t.charAt(0);"?"!==n&&"#"!==n||(t=t.substring(1));var i,o,r,a,s=t.split("&"),l={true:!0,false:!1};for(i=s.length-1;i>=0;--i)(o=s[i])&&(r=o.indexOf("="))>0&&(a=decodeURIComponent(o.substring(r+1)),l.hasOwnProperty(a)&&(a=l[a]),e[o.substring(0,r)]=a);return e},_args:null,_url:"",_parseLocation:function(){var t=window.location;if(this._url!==t.href||!this._args){this._url=t.href;var e={};this.parse(t.search,e),this.parse(t.hash,e),this._args=e}return this._args}},Object.defineProperties(t.Utils,{browser:{get:function(){return jQuery.extend({},n)}}});var i=Array.prototype;i.contains_li||Object.defineProperty(i,"contains_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;return this.indexOf(t)>=0}}),i.select_li||Object.defineProperty(i,"select_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;var e=Object(this).length>>>0;if(0===e)return[];var n=new Array(e);return this.each_li(function(e,i){n[e]=t(i,e)}),n}}),i.removeAll_li||Object.defineProperty(i,"removeAll_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;var e=Object(this).length>>>0;if(0===e)return-1;for(var n=e-1;n>=0;--n)t(this[n],n)&&this.splice(n,1)}}),i.first_li||Object.defineProperty(i,"first_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;var e=this.firstIndexOf_li(t);return e>=0?this[e]:null}}),i.firstIndexOf_li||Object.defineProperty(i,"firstIndexOf_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;var e=Object(this).length>>>0;if(0===e)return-1;for(var n=0;n<e;++n){if(t(this[n]))return n}return-1}}),i.where_li||Object.defineProperty(i,"where_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;if(0===Object(this).length>>>0)return[];var e=[];return this.each_li(function(n,i){t(i,n)&&e.push(i)}),e}}),i.each_li||Object.defineProperty(i,"each_li",{enumerable:!1,value:function(e){if(null==this)throw new TypeError;var n=Object(this).length>>>0;if(0===n)return[];for(var i=0;i<n;++i)try{e.apply(null,[i,this[i]])}catch(e){t.Logger.error(e)}}}),i.remove_li||Object.defineProperty(i,"remove_li",{enumerable:!1,value:function(t){if(null==this)throw new TypeError;if(0===Object(this).length>>>0)return-1;var e=this.indexOf(t);return e>=0?(this.splice(e,1),e):-1}}),t.Logger=function(){var t={log:!1,debug:!1,warn:!1,error:!1,trace:!1};return{_logs:[],config:function(e){$.extend(t,e)},ignore:function(){},log:function(){t.log&&this._log("log",Array.prototype.slice.call(arguments))},error:function(){t.error&&this._log("error",Array.prototype.slice.call(arguments))},debug:function(){t.debug&&this._log("log",Array.prototype.slice.call(arguments))},trace:function(){if(t.trace){var e=Error().stack,n=e?[e.replace("Error","Debug:"),"\n"]:[];this._log("log",n.concat(Array.prototype.slice.call(arguments)))}},warn:function(){this._log("warn",Array.prototype.slice.call(arguments))},_log:function(t,e){var n=new Date,i=[n.getMinutes(),n.getSeconds(),n.getMilliseconds()].join(":");e.unshift(i+">"),this._logs.push({method:t,logs:e}),this.scheduleDump()},dump:function(){var t=this._logs;this._logs=[],t.forEach(function(t){console[t.method].apply(console,t.logs)})},timeout:null,scheduleDump:function(){this.timeout||(this.timeout=setTimeout(function(){this.timeout=null,this.dump()}.bind(this),500))}}}(),t.utils.initJquery=function(){window.jQuery&&!window.jQuery.fn.scrollIntoView&&function(t){var e={vertical:{x:!1,y:!0},horizontal:{x:!0,y:!1},both:{x:!0,y:!0},x:{x:!0,y:!1},y:{x:!1,y:!0}},n={duration:"fast",direction:"both"},i=/^(?:html)$/i,o=function(e){var n=t(window),o=i.test(e[0].nodeName);return{border:o?{top:0,left:0,bottom:0,right:0}:function(e,n){n=n||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle);var i=!(!document.defaultView||!document.defaultView.getComputedStyle),o={top:parseFloat(i?n.borderTopWidth:t.css(e,"borderTopWidth"))||0,left:parseFloat(i?n.borderLeftWidth:t.css(e,"borderLeftWidth"))||0,bottom:parseFloat(i?n.borderBottomWidth:t.css(e,"borderBottomWidth"))||0,right:parseFloat(i?n.borderRightWidth:t.css(e,"borderRightWidth"))||0};return{top:o.top,left:o.left,bottom:o.bottom,right:o.right,vertical:o.top+o.bottom,horizontal:o.left+o.right}}(e[0]),scroll:{top:(o?n:e).scrollTop(),left:(o?n:e).scrollLeft()},scrollbar:{right:o?0:e.innerWidth()-e[0].clientWidth,bottom:o?0:e.innerHeight()-e[0].clientHeight},rect:function(){var t=e[0].getBoundingClientRect();return{top:o?0:t.top,left:o?0:t.left,bottom:o?e[0].clientHeight:t.bottom,right:o?e[0].clientWidth:t.right}}()}};t.fn.extend({scrollintoview:function(r){(r=t.extend({},n,r)).direction=e["string"==typeof r.direction&&r.direction.toLowerCase()]||e.both;var a="";!0===r.direction.x&&(a="horizontal"),!0===r.direction.y&&(a=a?"both":"vertical");var s=this.eq(0),l=s.closest(":scrollable("+a+")");if(l.length>0){l=l.eq(0);var c={e:o(s),s:o(l)},u={top:c.e.rect.top-(c.s.rect.top+c.s.border.top),bottom:c.s.rect.bottom-c.s.border.bottom-c.s.scrollbar.bottom-c.e.rect.bottom,left:c.e.rect.left-(c.s.rect.left+c.s.border.left),right:c.s.rect.right-c.s.border.right-c.s.scrollbar.right-c.e.rect.right},m={};!0===r.direction.y&&(u.top<0?m.scrollTop=c.s.scroll.top+u.top:u.top>0&&u.bottom<0&&(m.scrollTop=c.s.scroll.top+Math.min(u.top,-u.bottom))),!0===r.direction.x&&(u.left<0?m.scrollLeft=c.s.scroll.left+u.left:u.left>0&&u.right<0&&(m.scrollLeft=c.s.scroll.left+Math.min(u.left,-u.right))),t.isEmptyObject(m)?t.isFunction(r.complete)&&r.complete.call(l[0]):(i.test(l[0].nodeName)&&(l=t("html,body")),l.animate(m,r.duration).eq(0).queue(function(e){t.isFunction(r.complete)&&r.complete.call(l[0]),e()}))}return this}});var r={auto:!0,scroll:!0,visible:!1,hidden:!1};t.extend(t.expr[":"],{scrollable:function(t,n,o,a){var s=e[o&&"string"==typeof o[3]&&o[3].toLowerCase()]||e.both,l=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t,null):t.currentStyle,c={x:r[l.overflowX.toLowerCase()]||!1,y:r[l.overflowY.toLowerCase()]||!1,isRoot:i.test(t.nodeName)};if(!c.x&&!c.y&&!c.isRoot)return!1;var u={height:{scroll:t.scrollHeight,client:t.clientHeight},width:{scroll:t.scrollWidth,client:t.clientWidth},scrollableX:function(){return(c.x||c.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(c.y||c.isRoot)&&this.height.scroll>this.height.client}};return s.y&&u.scrollableY()||s.x&&u.scrollableX()}})}(window.jQuery)}}function o(e,n,i,o){return e.replace(/%MMM/g,(o.months||[])[n.getMonth()]).replace(/%M/g,(i("full_months")||[])[n.getMonth()]).replace(/%YY/g,n.getYear()%100).replace(/%Y/g,n.getFullYear()).replace(/%YY/g,n.getYear()%100).replace(/%hh/g,t.utils.padNumber(n.getHours())).replace(/%h/g,n.getHours()).replace(/%ma/g,o.minutesAgo).replace(/%mm/g,t.utils.padNumber(n.getMinutes())).replace(/%m/g,n.getMinutes()).replace(/%dd/g,t.utils.padNumber(n.getDate())).replace(/%d/g,n.getDate()).replace(/%F/g,o.dateString)}}(),function(t,e){function n(t){return t}function i(t,e,n){if((e=Boolean(e))?t.attr("readonly","readonly"):t.removeAttr("readonly"),n&&n.containerClass){var i=t.parents("."+n.containerClass);n.readOnlyClass&&i.toggleClass(n.readOnlyClass,e),n.readWriteClass&&i.toggleClass(n.readWriteClass,!e)}}function o(t,e){t.val("").css("height",""),i(t,!0,e)}function r(t){return t&&t.attr("readonly")}t||(t=window.App={});var a="data-annotation-id",s={fitOnInit:!0},l=(window.console,/\[\[([^\]]+)\]\]/),c=t.AnnotationsUI=function(){this._owner=null,this._revertTimeouts=[],this._deselectTimeouts=[],this._selectTimeouts=[],this._blurTimeouts=[],this._revertTimeouts.name="revert timeouts",this._deselectTimeouts.name="deselect timeouts",this._selectTimeouts.name="select timeouts",this._blurTimeouts.name="blur timeouts",this._updateInterval=null,this._isEnabled=!1,this._getLocalizedString=n};t.AnnotationsUI.Events={ANNOTATION_UI_CREATED:"annotationui:created",ANNOTATION_UI_REMOVED:"annotationui:removed",ANNOTATION_UI_SELECTED:"annotationui:selected",ANNOTATION_UI_CHANGED:"annotationui:changed",COMMENT_UI_CREATED:"commentui:created",COMMENT_UI_CHANGED:"commentui:changed",COMMENT_UI_DONE:"commentui:done",COMMENT_UI_REMOVED:"commentui:removed",COMMENT_UI_BEFORE_COMMAND:"commentui:before-command",COMMENT_UI_AFTER_COMMAND:"commentui:after-command"},t.AnnotationsUI.Commands={SUBMIT:"comment-submit",REPLY_DONE:"reply-done",COMMENT_CANCEL:"comment-cancel",COMMENT_OPEN:"open-comment",COMMENT_CLOSE:"close-comment",COMMENT_MENU:"comment-open-menu",COMMENT_MENU_ITEM:"comment-menu-item",COMMENT_EDIT_OK:"comment-edit-submit",COMMENT_EDIT_CANCEL:"comment-edit-cancel",COMMENT_EDIT:"comment-edit",COMMENT_RESOLVE:"resolve",COMMENT_DELETE:"comment-delete"},t.AnnotationsUI.prototype=e.extend({},t.EventsMixin);var u=t.AnnotationsUI.prototype;u.init=function(n){n?(this._commandMap=this._createCommandMap(),this.$container=n.container,this.$annotationTemplate=n.annotationTemplate,this.$commentTemplate=n.commentTemplate,this.$container&&this.$container.length||t.Logger.error("AnnotationsUI: Bad or missing comments container"),this.$annotationTemplate&&this.$annotationTemplate.length||t.Logger.error("AnnotationsUI: Bad or missing annotation template"),this.$commentTemplate&&this.$commentTemplate.length||t.Logger.error("AnnotationsUI: Bad or missing comment template"),this._templateClass=n.templateClass||"lance-tmpl",this._autogrowOptions=e.extend(!0,{},s,n.autoGrow||{}),this._blurAware=!1!==n.blurAware,this._preventScroll=!1===n.autoScroll,this.textareaOptions=n.textareaOptions&&e.extend(!0,{},n.textareaOptions),this.setOwner(n.owner)):t.Logger.error("AnnotationsUI inited with no options")},u.setGetLocalizedString=function(t){this._getLocalizedString=t||n},u.getOwner=function(t,e){return this._owner},u.setOwner=function(e,i){e!==this._owner&&(this._owner&&this._owner.removeListener(null,this),this._owner=e,this._getLocalizedString=e&&e.getLocalizedString||n,e?(this._setEnabled(e.isEnabled()),e.bind(t.Annotations.Events.ANNOTATION_UPDATED,this._onAnnotationUpdated,this),e.bind(t.Annotations.Events.ATTRIBUTE_CHANGED,this._onAnnotationAttributeChanged,this),e.bind(t.Annotations.Events.ANNOTATION_CREATED,this._onAnnotationCreated,this),e.bind(t.Annotations.Events.ANNOTATION_DELETED,this._onAnnotationDeleted,this),e.bind(t.Annotations.Events.ANNOTATION_RESOLVED,this._onAnnotationResolved,this),e.bind(t.Annotations.Events.ANNOTATION_SELECTED,this._onAnnotationSelected,this),e.bind(t.Annotations.Events.ANNOTATION_SELECTED,this._onAnnotationSelected,this),e.bind(t.Annotations.Events.COMMENT_SELECTED,this._onCommentSelected,this),e.bind(t.Annotations.Events.COMMENT_ADDED,this._onCommentAdded,this),e.bind(t.Annotations.Events.COMMENT_CHANGED,this._onCommentChanged,this),e.bind(t.Annotations.Events.COMMENT_DELETED,this._onCommentDeleted,this),e.bind(t.Annotations.Events.RESET,this._onReset,this),e.bind(t.Annotations.Events.RELOAD,this._onReload,this),e.bind(t.Annotations.Events.ENABLED_CHANGED,this._onEnabledChanged,this),e.addCustomAttributes("data-closed")):this._isEnabled=!1,!1!==(i&&i.load)&&this._reload())},u.getAnnotationIdForNode=function(t){return(t=this.getAnnotationNode(t))&&e(t).attr(a)},u.getAnnotationNode=function(t){return t=t instanceof e?t:e(t),this.isAnnotationNode(t)?t:t.parents(".annotation-ui")[0]||null},u.isAnnotationNode=function(t){return t=t instanceof e?t:e(t),Boolean(t.hasClass("annotation-ui")&&t.attr(a))},u.addAnnotation=function(e,n){var i=this._getAnnotationTemplate(),o=this._findAnnotationUi(n);o&&o.length?o.before(i):this.$container.append(i),this._bindFocusHandlers(i),this._populateAnnotation(i,e),this.trigger(t.AnnotationsUI.Events.ANNOTATION_UI_CREATED,{$node:i,ui:this,id:e.id})},u.removeAnnotation=function(e){var n=this._findAnnotationUi(e);n&&(this.trigger(t.AnnotationsUI.Events.ANNOTATION_UI_REMOVED,{id:e,$node:n,ui:this}),n.remove())},u.updateAnnotation=function(e){if(e){var n=this._findAnnotationUi(e.id);n&&(this._populateAnnotation(n,e),this.trigger(t.AnnotationsUI.Events.ANNOTATION_UI_CHANGED,{$node:n,ui:this,id:e.id}))}},u.updateComment=function(e,n,i){if(e&&n){var o=this._findCommentUi(e.id,n.id);o&&(i=i||this._owner&&this._owner.getCommentStatus(e.id,n.id),this._populateComment(o,n,e.id,i),this.trigger(t.AnnotationsUI.Events.COMMENT_UI_CHANGED,{$node:o,ui:this,id:e.id}))}},u.selectAnnotation=function(n,i){if(n){var o=this._findAnnotationUi(n.id);if(o){i=Boolean(i);var r="true"===o.attr("data-selected"),s=this;if(o.attr("data-selected",Boolean(i)),i){var l,c,u,m,d;if(this._preventScroll&&(m=(u=o[0].ownerDocument)&&(u.defaultView||u.parentWindow))&&(l=(d=e(m)).scrollLeft(),c=d.scrollTop()),o.focus(),this._handleAnnotationFocus(o),!r)o.find(".comment-ui").length;"number"==typeof c&&m.scrollTo(l,c),this.trigger(t.AnnotationsUI.Events.ANNOTATION_UI_SELECTED,{isSelected:!0,$node:o,ui:this,id:o.attr(a)})}else o.find(".comment-ui").attr("data-selected",!1),o.find(".comment-ui[data-comment-insert=true]").each(function(t,n){s._onAddCommentText(e(n))}),o.find(".comment-ui[data-comment-edit=true]").each(function(t,n){s._onCancelCommentText(e(n))}),this.trigger(t.AnnotationsUI.Events.ANNOTATION_UI_SELECTED,{isSelected:!1,$node:o,ui:this,id:o.attr(a)}),this._blurAware&&this._owner.compactAnnotation(n.id)}}},u._reload=function(){var t=this._owner;if(this._onReset(),t){var e,n,i=t.countAnnotations();for(n=0;n<i;++n)e=t.getAnnotationByIndex(n),this.addAnnotation(e)}},u._selectComment=function(t,e,n,i){if(t&&e){var o=this._findCommentUi(t.id,e.id);if(o){if(n=Boolean(n),i=Boolean(i),n){var r=this._findAnnotationUi(t.id);this._selectCommentNode(r.find(".comment-ui[data-selected='true']"),{select:!1})}this._selectCommentNode(o,{select:n,edit:i})}}},u._selectCommentNode=function(e,n){if(e.attr("data-selected",n.select),n.select&&n.edit&&this._isEnabled){t.Logger.debug("entering comment edit mode",e.attr(a)),e.attr({"data-comment-insert":!0,"data-comment-edit":!1});var o=e.find(".comment-reply-text");if(r(o)&&i(o,!1,this.textareaOptions),o.focus(),setTimeout(function(){o.focus(),o.select()},50),this._blurAware){var s=o.value;this._addTimeout(e,this._blurTimeouts,function(){var n=o.is(":focus");t.Logger.debug("textfield focused flag",n,"for",e.attr(a)),n||(o.val()!=s?this._onAddCommentText(e):this._onCancelCommentText(e))})}i(e.find(".comment-text"),!0,this.textareaOptions)}},u._findAnnotationUi=function(t){if(!t)return null;var e=this.$container.find(".annotation-ui[data-annotation-id='"+t+"']");return e&&e.length?e:null},u._findCommentUi=function(t,e){if(t&&e){var n=this.$container.find("[data-annotation-id='"+t+"'][data-comment-id='"+e+"']");return n&&n.length?n:null}return null},u._populateComment=function(n,r,a,s){if(n.find(".comment-user-name").html(r.userName),n.find(".comment-time-stamp").html(t.utils.relativeDateFormat(r.time,this._getLocalizedString)),n.find(".comment-avatar").css("background-image","url("+r.getUserPicture()+")"),s){var l=Boolean(s.isSelected);n.attr({"data-comment-edit":!1,"data-comment-insert":!1,"data-comment-id":r.id,"data-annotation-id":a,"data-comment-first":Boolean(s.isFirst),"data-comment-last":Boolean(s.isLast),"data-comment-new":Boolean(s.isNew),"data-comment-owner":Boolean(s.isOwnerComment),"data-comment-can-edit":Boolean(s.canEdit),"data-comment-can-delete":Boolean(s.canDelete),"data-comment-can-resolve":Boolean(s.canResolve)}),n.find("[data-lance-command='resolve']").attr("disabled",s.canResolve?null:"disabled"),n.find("[data-lance-command='comment-edit']").attr("disabled",s.canEdit?null:"disabled"),n.find("[data-lance-command='comment-delete']").attr("disabled",s.canDelete?null:"disabled");var c=n.find(".comment-text");c.val(r.text).trigger("propertychange"),i(c,!0,this.textareaOptions),(c=n.find(".comment-reply-text")).attr("placeholder",this._getLocalizedString(s.isNew?"enter your comment":"reply to this comment")),o(c,this.textareaOptions),n.find(".comment-ok").html(this._getLocalizedString(s.isNew?"comment":"reply")),e.ui&&e.ui.button&&n.find(".btn").button(),this._selectCommentNode(n,{select:l}),e.ui&&e.ui.menu&&n.find(".comment-edit-menu-list").menu()}},u._populateAnnotation=function(e,n){var i=n.id;e.attr({"data-annotation-id":i,"data-selected":n.isSelected(),"data-annotation-resolved":n.isResolved()?"true":null}),this._copyAnnotationAttributes(n,e),e.find(".comment-ui").remove();for(var o=e.find(".annotation-comments"),r=0,a=n.count();r<a;++r){var s,l=n.getCommentByIndex(r),c=this._owner.getCommentStatus(i,l.id),u=this._getCommentTemplate(r);this._populateComment(u,l,i,c),o.append(u),this._autogrowOptions&&(s=u.find("textarea.autogrow-textarea")).autoGrow&&s.autoGrow(this._autogrowOptions),this.trigger(t.AnnotationsUI.Events.COMMENT_UI_CREATED,{$node:u,ui:this,commentId:l.id,annotationId:i})}this.trigger(t.AnnotationsUI.Events.ANNOTATION_UI_CHANGED,{$node:e,ui:this,id:i})},u._copyAnnotationAttributes=function(t,e){e.attr(t.attributes)},u._trySelectAnnotation=function(t){if(this._owner){this._removeTimeouts(t,{deselect:!0});var e=t.attr(a);this._owner.selectAnnotation(e,!0)}},u._handleAnnotationFocus=function(t,e){if(this._removeDeselectTimeout(t),!1!==e){var n=function(){this._removeTimeouts(t,{deselect:!0})};n.call(this),this._addTimeout(t,this._selectTimeouts,n)}},u._trySelectComment=function(t,e){if((this._handleAnnotationFocus(t),this._owner)&&("true"!==t.attr("data-selected")||e&&r(t.find(".comment-reply-text")))){var n=t.attr(a),i=t.attr("data-comment-id");this._owner.selectComment(n,i,!0,e)}},u._tryEditComment=function(t){if(this._owner&&this._isEnabled){var e=t.attr(a),n=t.attr("data-comment-id"),r=this._owner.getCommentStatus(e,n);if(this._trySelectComment(t),(r=this._owner.getCommentStatus(e,n)).isSelected&&r.canEdit){this._removeTimeouts(t,{blur:!0,deselect:!0});var s=t.find(".comment-reply-text");o(s,this.textareaOptions),t.attr("data-comment-insert",!1),s=t.find(".comment-text"),t.attr("data-comment-edit",!0),i(s,!1,this.textareaOptions),s.focus()}}},u._onDeleteComment=function(n){if(this._owner&&this._isEnabled){var i=n.attr(a),o=n.attr("data-comment-id"),r=this._owner.getCommentStatus(i,o),s=r&&r.isFirst||!1,l=this._getLocalizedString(s?"delete this annotation?":"delete this comment?"),c=this._findAnnotationUi(i),u=s?c:n,m=function(){s?d.deleteAnnotation(i):d.deleteComment(i,o)};t.utils.scrollToElement(u);var d=this._owner;if(e.ui&&e.ui.dialog){var h=e("<div>"+l+"</div>"),f={};f[this._getLocalizedString("delete")]=function(){e(this).dialog("close"),m()},f[this._getLocalizedString("cancel")]=function(){e(this).dialog("close")},h.dialog({resizable:!1,modal:!0,width:Math.round(.97*c.outerWidth()),height:Math.round(.99*u.outerHeight()),autoOpen:!1,dialogClass:"no-title-dialog no-skin-dialog no-modal-dialog",position:{at:"left-14 top+1",my:"left top",of:u},buttons:f}),h.dialog("open")}else window.confirm(l)&&m()}},u._localizeNode=function(t){var e,n,i,o,r,a=t&&t.nodeType;if(1===a){if((e=t.hasAttributes()&&t.attributes)&&e.length)for(o=0,r=e.length;o<r;++o)(n=e[o].value)&&(i=String(n).match(l))&&(n=this._getLocalizedString(i[1]))&&t.setAttribute(e[o].name,n);for(var s=t.firstChild;s;s=s.nextSibling)this._localizeNode(s)}else 3===a&&t.nodeValue&&(i=String(t.nodeValue).match(l))&&(t.nodeValue=this._getLocalizedString(i[1]))},u._getAnnotationTemplate=function(){var t=this.$annotationTemplate.clone();return this._localizeNode(t[0]),t.removeClass(this._templateClass).addClass("annotation-ui"),t.on("click","[data-lance-command]",function(t){this._onCommandEvent(t)}.bind(this)),t},u._bindFocusHandlers=function(n){n.focusout(function(i){setTimeout(function(){var o=n.attr(a),r=i.relatedTarget;if(t.Logger.debug("node focus out event handler",o),r){var s=e(r).parents("[data-annotation-id='"+o+"']");if(s&&s.length)return void t.Logger.debug("focusout, related target's parents are",s[0])}this._onNodeLostFocus(n)}.bind(this),1)}.bind(this)),n.focusin(function(e){setTimeout(function(){var e=n.attr(a);t.Logger.debug("node focus in event handler",e),this._trySelectAnnotation(n)}.bind(this),100)}.bind(this))},u._setButtonsText=function(t,e,n){var i,o=t.find(e);o.length&&((i=o.find(".ui-button-text")).length&&(o=i),o.html(this._getLocalizedString({key:n,useKey:!1})))},u._getCommentTemplate=function(t){var e=this.$commentTemplate.clone();this._localizeNode(e[0]),e.removeClass(this._templateClass).addClass("comment-ui"),e.find(".comment-text").click(function(t,n){this._trySelectComment(e,!1)}.bind(this)),e.find(".comment-reply-text").click(function(t,n){this._trySelectComment(e,!0)}.bind(this)).on("input propertychange",function(t){this._onReplyChanged(e)}.bind(this));var n=function(t,n){e.find(t).attr("data-lance-command",n)},i={".comment-ok":c.Commands.SUBMIT,".comment-new-done":c.Commands.REPLY_DONE,".comment-cancel":c.Commands.COMMENT_CANCEL,".comment-open":c.Commands.COMMENT_OPEN,".comment-close":c.Commands.COMMENT_CLOSE,".comment-edit-menu-icon":c.Commands.COMMENT_MENU,".comment-edit-menu-list a":c.Commands.COMMENT_MENU_ITEM,".comment-edit-ok":c.Commands.COMMENT_EDIT_OK,".comment-edit-cancel":c.Commands.COMMENT_EDIT_CANCEL,".comment-edit":c.Commands.COMMENT_EDIT,".comment-resolve":c.Commands.COMMENT_RESOLVE,".comment-delete, .comment-resolve":c.Commands.COMMENT_DELETE};for(var o in i)i.hasOwnProperty(o)&&n(o,i[o]);return e.click(function(t){this._trySelectComment(e)}.bind(this)),e},u._onCommandEvent=function(n){var i=n.currentTarget,o=i&&i.getAttribute&&i.getAttribute("data-lance-command");if(o){var r=e(i).closest("[data-comment-id]"),s=r.attr("data-comment-id"),l=r.attr(a),c={command:o,$node:r,ui:this,annotationId:l,commentId:s,cancel:!1};this.trigger(t.AnnotationsUI.Events.COMMENT_UI_BEFORE_COMMAND,c),!c.cancel&&this._commandMap[o]?(n.preventDefault(),this._commandMap[o].call(this,n,r),c={command:o,$node:r,ui:this,annotationId:l,commentId:s},this.trigger(t.AnnotationsUI.Events.COMMENT_UI_AFTER_COMMAND,c)):t.Logger.warn("Unhandled command",o)}else t.Logger.warn("Lance onCommandEvent: missing command")},u._createCommandMap=function(){return{"comment-submit":function(t,e){this._onAddCommentText(e),this._owner.doneEditing()},resolve:function(t,e){this._resolveAnnotationByCommentNode(e)},"comment-open":function(t,e){this._setAnnotationAttribute(e,"data-closed",!1)},"comment-submit-ok":function(e,n){""!=n.find(".comment-reply-text").val()?(this._onAddCommentText(n),this.trigger(t.AnnotationsUI.Events.COMMENT_UI_DONE,{$node:n,ui:this,id:n.attr(a)})):this._onCancelCommentText(n),this._owner.doneEditing()},"comment-cancel":function(t,e){this._onCancelCommentText(e)},"open-comment":function(t,e){this._setAnnotationAttribute(e,"data-closed",!1)},"comment-open-menu":function(t,e){this._onMenuIconClicked(e)},"comment-menu-item":function(t,e){this._closeCommentMenu(e)},"close-comment":function(t,e){this._setAnnotationAttribute(e,"data-closed",!0)},"comment-edit-menu":function(t,e){this._onMenuIconClicked(e)},"comment-menu-item":function(t,e){this._closeCommentMenu(e)},"comment-edit-submit":function(t,e){this._onSaveCommentText(e)},"comment-edit-cancel":function(t,e){this._onRevertCommentText(e)},"comment-edit":function(t,e){this._tryEditComment(e,!0)},"comment-delete":function(t,e){this._onDeleteComment(e)}}},u._openCommentMenu=function(t){var e=t.find(".comment-edit-menu-icon"),n=t.find(".comment-edit-menu-list");e.attr("class","comment-edit-menu-icon arrow-right"),e.attr("data-menu-open","true"),n.show()},u._setAnnotationAttribute=function(t,e,n){annotationId=t.attr(a),this._owner.setAttribute(annotationId,e,n)},u._closeCommentMenu=function(t){var e=t.find(".comment-edit-menu-icon"),n=t.find(".comment-edit-menu-list");e.attr("class","comment-edit-menu-icon arrow-down"),e.attr("data-menu-open","false"),n.hide()},u._onMenuIconClicked=function(t){"true"===t.find(".comment-edit-menu-icon").attr("data-menu-open")?this._closeCommentMenu(t):(this._closeCommentMenu(e('[data-menu-open="true"]').parentsUntil(".comment-ui")),this._openCommentMenu(t))},u._resolveAnnotationByCommentNode=function(t){if(this._owner&&this._isEnabled){var e=t.attr("data-comment-id"),n=t.attr(a);this._owner.resolveAnnotation(n,e,!0)}},u._onAddCommentText=function(t){if(this._removeTimeouts(t,{revert:!0,blur:!0}),this._owner&&this._isEnabled){var n=t.find(".comment-reply-text");if(!r(n)){var o=t.attr("data-comment-id"),s=t.attr(a),l=n.val()||"",c=e.trim(l);i(n,!0,this.textareaOptions),t.attr("data-comment-insert",!1),c.length&&this._owner.addComment(s,o,l)}}},u._onCancelCommentText=function(t){if(this._removeTimeouts(t,{revert:!0,blur:!0}),this._owner&&this._isEnabled){var e,n=t.attr("data-comment-id"),i=t.attr(a),o=this._owner.getComment(i,n),r=t.find(".comment-text");o&&r!=o.text&&(this._owner.revertComment(i,n,!0),e=this._owner.getComment(i,n),this._onCommentChanged(e))}},u._onSaveCommentText=function(e){this._removeTimeouts(e,{all:!0});var n=e.find(".comment-text");if(this._isEnabled&&!r(n)){if(i(n,!0,this.textareaOptions),e.attr("data-comment-edit",!1),this._owner){var o=e.attr("data-comment-id"),s=e.attr(a);this._owner.setCommentText(s,o,n.val()),this._owner.doneEditing()}this.trigger(t.AnnotationsUI.Events.COMMENT_UI_DONE,{$node:e,ui:this,id:e.attr(a)})}},u._removeTimeouts=function(t,e){var n=[],i=Boolean(e&&e.all);(i||e.revert)&&n.push(this._revertTimeouts),(i||e.blur)&&n.push(this._blurTimeouts),(i||e.deselect)&&n.push(this._deselectTimeouts),(i||e.select)&&n.push(this._selectTimeouts),n.forEach(function(e){this._removeTimeout(t,e)}.bind(this))},u._removeRevertTimeout=function(t){this._removeTimeout(t,this._revertTimeouts)},u._removeDeselectTimeout=function(t){this._removeTimeout(t,this._deselectTimeouts)},u._removeTimeout=function(t,e){var n,i,o=t.attr(a);for(n=e.length-1;n>=0;--n)(i=e[n]).node&&i.node.attr(a)===o&&(i.timeout&&(clearTimeout(i.timeout),i.timeout=null),e.splice(n,1))},u._addTimeout=function(t,e,n){this._removeTimeout(t,e);var i={node:t};i.timeout=setTimeout(function(){this._removeTimeout(t,e),n.call(this)}.bind(this),210),e.push(i)},u._hasTimeout=function(t,e){var n=t.attr(a);return e.firstIndexOf_li(function(t){return t.node&&t.node.attr(a)==n})>=0},u._onNodeLostFocus=function(t){this._removeTimeout(t,this._selectTimeouts),this._addTimeout(t,this._deselectTimeouts,function(){var e=t.attr(a);this._owner.selectAnnotation(e,!1)})},u._onReplyChanged=function(t){var e=Boolean(t.find(".comment-reply-text").val()),n=t.find(".comment-ok");e?n.removeAttr("disabled"):n.attr("disabled","disabled")},u._onRevertCommentText=function(t,e){if(this._isEnabled&&(this._removeRevertTimeout(t),t.attr("data-comment-edit",!1),i(t.find(".comment-text"),!0,this.textareaOptions),this._owner)){var n=t.attr("data-comment-id"),o=t.attr(a);this._owner.revertComment(o,n,e);var r=this._owner.getComment(o,n);this._onCommentChanged(r)}},u._onAnnotationChanged=function(t){this.updateAnnotation(t&&t.annotation)},u._onAnnotationSelected=function(t){t&&this.selectAnnotation(t.annotation,t.isSelected)},u._onAnnotationResolved=function(t){this.updateAnnotation(t&&t.annotation)},u._onAnnotationUpdated=function(t){this.updateAnnotation(t&&t.annotation)},u._onAnnotationDeleted=function(t){this.removeAnnotation(t&&t.id),this._setUpdateInterval()},u._onAnnotationCreated=function(t){t&&(this.addAnnotation(t.annotation,t.before),this._setUpdateInterval())},u._onCommentSelected=function(t){t&&this._selectComment(t.annotation,t.comment,t.isSelected,t.isEdit)},u._onAnnotationAttributeChanged=function(t){var e=this._findAnnotationUi(t.annotation.id);this._copyAnnotationAttributes(t.annotation,e)},u._onCommentChanged=function(t){t&&this.updateComment(t.annotation,t.comment,t.status)},u._onCommentAdded=function(t){t&&this._onAnnotationChanged(t)},u._onCommentDeleted=function(t){this.updateAnnotation(t&&t.annotation)},u._onReset=function(){this.$container.find("textarea").unbind(),this.$container.find("a").unbind(),this.$container.find(".annotation-ui").remove()},u._onReload=function(){this._reload()},u._onEnabledChanged=function(t){var e=t&&t.isEnabled;this._setEnabled(e)},u._onRenumbered=function(t){},u._setEnabled=function(t){this._isEnabled=Boolean(t),this._isEnabled?this.$container.removeAttr("disabled"):(i(this.$container.find("textarea"),!0,this.textareaOptions),this.$container.attr("disabled","disabled"))},u._setUpdateInterval=function(){this._owner.countAnnotations()>0?this._updateInterval=this._updateInterval||setInterval(this._updateUIPeriodical.bind(this),6e4):this._updateInterval&&(clearInterval(this._updateInterval),this._updateInterval=null)},u._updateUIPeriodical=function(){var t,e,n,i,o,r,a,s=this._owner.countAnnotations();for(t=0;t<s;++t)if(i=this._owner.getAnnotationByIndex(t),o=this._findAnnotationUi(i.id))for(e=0,n=i.count();e<n;++e)r=i.getCommentByIndex(e),a=o.find("[data-comment-id='"+r.id+"']"),this._populateComment(a,r)}}(window&&window.$LOOPINDEX$,window&&window.jQuery)}()}]);